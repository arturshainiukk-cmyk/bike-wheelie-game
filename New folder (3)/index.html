<!DOCTYPE html>
<html>
<head>
  <title>Bike Wheelie 3D Pro</title>
  <style>
    body { margin:0; overflow:hidden; background:#000; color:white; font-family:sans-serif; }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.6);
      padding: 10px;
      border-radius: 8px;
    }
    input { width: 80px; }
  </style>
</head>
<body>

<div id="ui">
  <b>Bike Editor</b><br>
  Speed <input id="speed" type="range" min="0.05" max="0.3" step="0.01"><br>
  Wheelie <input id="wheelie" type="range" min="0.001" max="0.01" step="0.001"><br>
  Stability <input id="stability" type="range" min="0.002" max="0.02" step="0.002"><br>
  <p id="hud"></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x111111);

let camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(-5, 4, 8);

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Light
scene.add(new THREE.AmbientLight(0xffffff, 0.7));
let light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(5,10,5);
scene.add(light);

// Ground
let ground = new THREE.Mesh(
  new THREE.BoxGeometry(200,1,20),
  new THREE.MeshStandardMaterial({color:0x333333})
);
ground.position.y = -1;
scene.add(ground);

// Bike
let bike = new THREE.Group();

let body = new THREE.Mesh(
  new THREE.BoxGeometry(2,0.4,0.5),
  new THREE.MeshStandardMaterial({color:0xffffff})
);

let wheelGeo = new THREE.CylinderGeometry(0.5,0.5,0.3,16);
let wheelMat = new THREE.MeshStandardMaterial({color:0x000000});
let w1 = new THREE.Mesh(wheelGeo,wheelMat);
let w2 = new THREE.Mesh(wheelGeo,wheelMat);

w1.rotation.z = Math.PI/2;
w2.rotation.z = Math.PI/2;
w1.position.x = -0.8;
w2.position.x = 0.8;
w1.position.y = -0.4;
w2.position.y = -0.4;

bike.add(body,w1,w2);
bike.position.y = 0;
scene.add(bike);

// Bike physics
let stats = JSON.parse(localStorage.getItem("bikeStats")) || {
  speed:0.12,
  wheelie:0.004,
  stability:0.01
};

let vel = 0;
let angleVel = 0;
let distance = 0;
let score = 0;
let combo = 1;
let airTime = 0;

const keys = {};
addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

// Mobile tilt
let tilt = 0;
addEventListener("deviceorientation", e => tilt = e.gamma/40);

function vibrate(ms){ if(navigator.vibrate) navigator.vibrate(ms); }

function update(){
  if(keys.w) vel += stats.speed;
  vel *= 0.97;

  if(keys.e){ angleVel += stats.wheelie; vibrate(5); }
  if(keys.q) angleVel -= stats.wheelie*1.5;

  angleVel += tilt*0.002;
  angleVel -= bike.rotation.z * stats.stability;

  bike.rotation.z += angleVel;
  angleVel *= 0.98;

  bike.position.x += vel;
  distance += vel;

  // Jump ramps
  if(Math.floor(bike.position.x)%30 === 0){
    bike.position.y += 0.1;
    airTime++;
  } else {
    bike.position.y *= 0.9;
  }

  // Tricks
  if(Math.abs(bike.rotation.z) > 0.6) {
    score += 1 * combo;
    combo = Math.min(combo+0.01, 3);
  }

  if(airTime > 10){
    score += 50 * combo;
    vibrate(30);
    airTime = 0;
  }

  if(Math.abs(bike.rotation.z) > 1.4){
    vibrate(200);
    bike.position.set(0,0,0);
    bike.rotation.z = 0;
    vel = 0;
    combo = 1;
  }

  camera.position.x = bike.position.x - 6;
  camera.lookAt(bike.position);

  document.getElementById("hud").innerText =
    `Distance: ${Math.floor(distance)}\nScore: ${Math.floor(score)}\nCombo x${combo.toFixed(1)}`;
}

function animate(){
  update();
  renderer.render(scene,camera);
  requestAnimationFrame(animate);
}
animate();

// Bike editor
["speed","wheelie","stability"].forEach(id=>{
  let el = document.getElementById(id);
  el.value = stats[id];
  el.oninput = () => {
    stats[id] = parseFloat(el.value);
    localStorage.setItem("bikeStats", JSON.stringify(stats));
  };
});

onresize = ()=> {
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
};
</script>

</body>
</html>
